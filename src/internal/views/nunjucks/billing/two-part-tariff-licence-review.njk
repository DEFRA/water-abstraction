{% extends "./nunjucks/layout.njk" %}
{% from "badge.njk" import badge %}
{% from "paginate.njk" import paginate %}
{% from "./nunjucks/billing/macros/batch-metadata.njk" import batchMetadata %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}

{% from "./nunjucks/billing/macros/totals.njk" import chargeOrDash %}
{% from "./nunjucks/billing/macros/batch-title.njk" import batchTitle %}
{% from "./nunjucks/billing/macros/batch-buttons.njk" import removeLicenceFromBatchButton %}
{% from "./nunjucks/billing/macros/two-part-tariff-review-quantities.njk" import authorisedQuantity, billableQuantity, reportedVolume, billableVolume %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/details/macro.njk" import govukDetails %}

{% block content %}

  <div class="govuk-grid-row govuk-!-margin-bottom-0">
    <div class="govuk-grid-column-two-thirds">
      {{ batchTitle(pageTitle, batch) }}
      
      {% set summaryHtml %}
        <a href="#">Licence details</a>
      {% endset %}

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        {{ govukDetails({
        summaryText: "Licence details",
        html: summaryHtml
      }) }}
      </div>
    </div>
      {{ removeLicenceFromBatchButton(batch, licence) }}
    </div>
  </div>

  <div class="govuk-grid-row govuk-!-margin-bottom-0">
    <div class="govuk-grid-column-full">

      {% for group in billingVolumeGroups %}
      
{% for billingVolume in group %}
{{ govukTable({
  firstCellIsHeader: true, 
   rows: [
    [ { text: "Issue", classes: "thick_black_underline" }, { text: billingVolume.error, classes: "thick_black_underline"  }, { text: "", classes: "thick_black_underline" } ],
    [ { text: "Billable returns" }, { html: billableVolume(billingVolume) }, 
      { html: "<a href='" + billingVolume.editLink + "'>
                  Change
                  <span class='govuk-visually-hidden'>
                    element "
                    + billingVolume.chargeElement.description +
                  "</span>
                </a>"
      }
    ],
    [ { text: "Reported returns", classes: "thick_black_underline"  }, { text: reportedVolume(billingVolume), classes: "thick_black_underline" }, { text: "", classes: "thick_black_underline"  } ],
    [ { text: "Billing Account" }, { text: "BA2423425235" }, { text: "" } ],
    [ { text: "Purpose" }, { text: "Spray - Irrigation" }, { text: "" } ],
    [ { text: "Description" }, { text: billingVolume.chargeElement.description }, { text: "" } ],
    [ { text: "Charge period" }, { text: billingVolume.chargePeriod.startDate | date("D MMMM") + " to " + billingVolume.chargePeriod.endDate | date("D MMMM") }, { text: "" } ],
    [ { text: "Abstraction period" }, { text: billingVolume.chargeElement.abstractionPeriod | abstractionPeriod }, { text: "" } ],
    [ { text: "Authorised" }, { text: authorisedQuantity(billingVolume.chargeElement) }, { text: "" } ],
    [ { text: "Billable" }, { text: billableQuantity(billingVolume.chargeElement) }, { text: "" } ]
  ]
}) }}
{% endfor %}
      {% endfor %}
    </div>
  </div>

{% endblock %}
